<%@ page contentType="text/html;charset=UTF-8" language="java" %><%@ page import="java.util.*" %><%@ page import="dao.Cart_Use" %><%@ page import="dao.Cart" %><%@ page import="java.sql.SQLException" %><%    // 检查用户是否已登录    if (session.getAttribute("upname") == null) {        response.sendRedirect("login.jsp"); // 如果未登录，重定向到登录页面        return; // 结束当前页面的执行    }%><html><head>    <title>购物车界面</title>    <link href="css/main.css" rel="stylesheet">    <link href="css/Gwc.css" rel="stylesheet">    <script src="js/jquery-3.4.1.min.js"></script>    <script>        // 这里的 JavaScript 代码保持不变    </script></head><body><div class="main_head">    <div class="logo"><img src="img/logo2.png"></div>    <div class="top_up">欢迎您：<%=session.getAttribute("upname")%>        <a href="cart.jsp">购物车</a>        <a href="allShop.jsp">全部商品</a>        <a href="logout">退出</a> <!-- 退出登录链接 -->        <a href="login.jsp" class="login-button">登录</a> <!-- 新增登录按钮 -->    </div></div><div class="main_down">    <div class="container">        <div class="cart_top"><span>购物车</span></div>        <div class="cart_wrap">            <table class="cart_table" border="1" cellspacing="0" bgcolor="#fffafa" rules="rows">                <tr class="cart_title">                    <th></th>                    <th>商品</th>                    <th>单价</th>                    <th>数量</th>                    <th>总价</th>                    <th>地址</th>                    <th>商家名称</th>                    <th>操作</th>                </tr>                <%                    String username = (String) session.getAttribute("upname");                    ArrayList<Cart> cartItems = null;                    try {                        cartItems = Cart_Use.getCartItems(username);                    } catch (SQLException e) {                        throw new RuntimeException(e);                    }                    for (Cart item : cartItems) {                %>                <tr class="cart_item">                    <td><input type="checkbox" class="check_one">&nbsp;</td>                    <td class="goods_name"><%=item.getGoodName()%></td>                    <td class="goods_price"><%=item.getPrice()%></td>                    <td>                        <input type="text" value="<%=item.getNumber()%>" class="goods_num">                    </td>                    <td><%=String.format("%.2f", item.getNumber() * Double.parseDouble(item.getPrice()))%></td>                    <td><input type="text" class="address" value="<%=item.getAddress()%>" placeholder="填写地址"></td>                    <td class="merchant_name"><%=item.getmerchantname()%></td>                    <td>                        <button onclick="deleteItem('<%=item.getId()%>')">删除</button>                    </td>                </tr>                <%                    }                %>            </table>            <button onclick="clearCart()">清空购物车</button>            <button onclick="checkout()">结算</button>        </div>        <div id="selectedItems" style="margin-top:20px; border: 1px solid #ccc; padding: 10px;"></div>    </div></div></body></html>