<%@ page contentType="text/html;charset=UTF-8" language="java" %><%@ page import="java.util.*" %><%@ page import="dao.Cart_Use" %><%@ page import="dao.Cart" %><%@ page import="java.sql.SQLException" %><html><head>    <title>购物车界面</title>    <link href="css/main.css" rel="stylesheet">    <link href="css/Gwc.css" rel="stylesheet">    <script src="js/jquery-3.4.1.min.js"></script>    <script>        function deleteItem(goodName) {            $.post("cartAction", { action: "delete", goodname: goodName }, function(response) {                if (response === "success") {                    alert("商品已删除");                    window.location.reload(); // 刷新当前页面                } else {                    alert("删除失败，请重试");                }            });        }        function clearCart() {            if (confirm("您确定要清空购物车吗？")) {                $.post("cartAction", { action: "clear" }, function(response) {                    if (response === "success") {                        alert("购物车已清空");                        window.location.reload(); // 刷新当前页面                    } else {                        alert("清空购物车失败，请重试");                    }                });            }        }        function checkout() {            let selectedItems = [];            $('.check_one:checked').each(function() {                let row = $(this).closest('tr');                let goodName = row.find('td:eq(0)').text(); // 商品名称                let quantity = row.find('.goods_num').val(); // 商品数量                let price = row.find('.goods_price').text(); // 商品单价                selectedItems.push({                    goodName: goodName,                    quantity: quantity,                    price: price                });            });            if (selectedItems.length === 0) {                alert("请至少选择一件商品进行结算！");                return;            }            // 将选中的商品信息传递到下单Servlet            $.ajax({                url: "iindent",                type: "POST",                data: { items: JSON.stringify(selectedItems) },                success: function(response) {                    alert("订单创建成功！");                    window.location.reload(); // 刷新页面                },                error: function() {                    alert("订单创建失败，请重试");                }            });        }    </script></head><body><div class="main_head">    <div class="logo"><img src="img/logo2.png"></div>    <div class="top_up">欢迎您：<%=session.getAttribute("upname")%>        <img src="img/grzx.png" width="50" height="50">        <a href="mainFrame.jsp"><img src="img/dztj.jpg" width="50" height="50"></a>        <a href="allShop.jsp"><img src="img/allshop.png" width="75" height="50"></a>    </div></div><div class="main_down">    <div class="container">        <div class="cart_top"><span>购物车</span></div>        <div class="cart_wrap">            <table class="cart_table" border="1" cellspacing="0" bgcolor="#fffafa" rules="rows">                <tr class="cart_title">                    <th>商品</th>                    <th>单价</th>                    <th>数量</th>                    <th>总价</th>                    <th>操作</th>                </tr>                <%                    String username = (String) session.getAttribute("upname");                    ArrayList<Cart> cartItems = Cart_Use.getCartItems(username);                    for (Cart item : cartItems) {                %>                <tr class="cart_item">                    <td><input type="checkbox" class="check_one">&nbsp;<%=item.getGoodName()%></td>                    <td class="goods_price"><%=item.getPrice()%></td>                    <td>                        <input type="text" value="<%=item.getNumber()%>" class="goods_num" id="qty_<%=item.getGoodName()%>">                    </td>                    <td><%=String.format("%.2f", item.getNumber() * Double.parseDouble(item.getPrice()))%></td>                    <td><button onclick="deleteItem('<%=item.getGoodName()%>')">删除</button></td>                </tr>                <%                    }                %>            </table>            <button onclick="clearCart()">清空购物车</button>            <button onclick="checkout()">结算</button> <!-- 结算按钮 -->        </div>    </div></div></body></html>